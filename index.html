<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anderson School Fee Management System v3.0 (CAD)</title>
    <style>
        :root {
            --primary-color: #007bff; /* Blue */
            --secondary-color: #6c757d; /* Gray */
            --success-color: #28a745; /* Green */
            --warning-color: #ffc107; /* Yellow */
            --danger-color: #dc3545; /* Red */
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-radius: 8px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header & Navigation */
        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 { color: var(--primary-color); }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            background-color: #e0e0e0;
            cursor: pointer;
            border-radius: var(--border-radius);
            font-weight: bold;
            transition: 0.3s;
        }

        .nav-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Sections */
        .section {
            display: none;
            background: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s;
        }

        .section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }

        label { display: block; margin-bottom: 5px; font-weight: 600; }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .input-group input, .input-group select {
            flex-grow: 1;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: background 0.2s;
        }

        .btn:hover { opacity: 0.9; }

        .btn-primary { background-color: var(--primary-color); }
        .btn-success { background-color: var(--success-color); }
        .btn-warning { background-color: var(--warning-color); color: #333; }
        .btn-danger { background-color: var(--danger-color); padding: 5px 10px; font-size: 0.8em;}
        .btn-info { background-color: #17a2b8; }
        .btn-secondary { background-color: var(--secondary-color); }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        th { background-color: #f1f1f1; }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
        }
        
        .stat-card h3 { margin: 0; font-size: 2em; }
        .stat-card p { margin: 5px 0 0 0; opacity: 0.9; }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        
        #itemizedList {
            list-style: none;
            padding: 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-height: 150px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        #itemizedList li {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #itemizedList li:last-child {
            border-bottom: none;
        }

        #notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 15px 25px;
            border-radius: 4px;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üéì School Fee Management System (CAD)</h1>
        <div class="nav-tabs">
            <button class="nav-btn active" onclick="showSection('payment')">üí∞ Payment Counter</button>
            <button class="nav-btn" onclick="showSection('records')">üìä Financial Records</button>
            <button class="nav-btn" onclick="showSection('students')">üë®‚Äçüéì Student Management</button>
            <button class="nav-btn" onclick="showSection('fees')">üìù Fee Settings</button>
        </div>
    </header>

    <div id="payment" class="section active">
        <h2>New Transaction</h2>
        <div class="dashboard-grid">
            <div class="form-group" style="grid-column: 1 / span 2;">
                <label for="payStudentSelect">Select Student:</label>
                <select id="payStudentSelect"></select>
            </div>
        </div>

        <div class="calculator-grid">
            <div>
                <h3>Itemized Sale Calculator</h3>
                <div class="input-group">
                    <input type="text" id="itemName" placeholder="Item Name (e.g. Notebook)" required>
                    <input type="number" id="itemPrice" placeholder="Price (CAD)" min="0.01" step="0.01" required>
                    <button class="btn btn-primary" onclick="addItemToCart()">Add Item</button>
                </div>
                <ul id="itemizedList"></ul>
                <div class="form-group">
                    <label for="manualTotal">OR Manually Enter Total Amount (CAD):</label>
                    <input type="number" id="manualTotal" placeholder="Enter Total Amount">
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <button class="btn btn-warning" onclick="resetCart()">Reset Items</button>
                </div>
            </div>
            <div style="background-color: #f1f1f1; padding: 15px; border-radius: 4px;">
                <h3>Transaction Summary</h3>
                <div class="form-group">
                    <label>Calculated Total (CAD):</label>
                    <input type="number" id="calculatedTotalDisplay" value="0.00" readonly style="font-size: 1.5em; text-align: right;">
                </div>
                <div class="form-group">
                    <label>Final Charge Amount (CAD):</label>
                    <input type="number" id="finalPayAmount" value="0.00" min="0.01" step="0.01" style="font-size: 1.5em; text-align: right; background-color: #e9ecef;">
                </div>
                <button class="btn btn-success" onclick="processPayment()" style="width: 100%; margin-top: 15px; font-size: 1.2em;">Confirm Payment</button>
            </div>
        </div>
    </div>

    <div id="records" class="section">
        <h2>Financial Overview</h2>
        <div class="dashboard-grid">
            <div class="stat-card">
                <h3 id="totalIncome">CAD 0.00</h3>
                <p>Total Revenue (Net)</p>
            </div>
            <div class="stat-card" style="background-color: var(--success-color);">
                <h3 id="totalTransactions">0</h3>
                <p>Total Transactions</p>
            </div>
        </div>
        
        <h3>Detailed Transaction Records</h3>
        <div class="action-bar">
            <button class="btn btn-warning" onclick="exportToExcel()">üì• Export to Excel (CSV)</button>
            <button class="btn btn-danger" onclick="clearAllData()">‚ö†Ô∏è Clear All Data</button>
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>Date/Time</th>
                    <th>Student Name</th>
                    <th>Fee/Item</th>
                    <th>Original Amount</th>
                    <th>Refunded Amount</th>
                    <th>Net Amount</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="recordsTableBody"></tbody>
        </table>
    </div>

    <div id="students" class="section">
        <h2>Student List Management</h2>
        
        <h3>Add New Student</h3>
        <div class="input-group" style="margin-bottom: 20px;">
            <input type="text" id="newStudentLName" placeholder="Last Name" required>
            <input type="text" id="newStudentFName" placeholder="First Name" required>
            <input type="text" id="newStudentDivision" placeholder="Division (e.g. Grade 10)" required>
            <button class="btn btn-primary" onclick="addStudent()">Add Student</button>
        </div>
        
        <h3>Search Students</h3>
        <div class="input-group" style="margin-bottom: 20px;">
            <input type="text" id="studentSearchInput" placeholder="Search by Last Name, First Name, or Division">
            <select id="studentSearchField">
                <option value="all">All Fields</option>
                <option value="lastName">Last Name</option>
                <option value="firstName">First Name</option>
                <option value="division">Division</option>
            </select>
            <button class="btn btn-info" onclick="renderStudents()">Search</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Student ID</th>
                    <th>Last Name</th>
                    <th>First Name</th>
                    <th>Division</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="studentTableBody"></tbody>
        </table>
    </div>

    <div id="fees" class="section">
        <h2>Standard Fee Item Setup (Optional)</h2>
        <div class="input-group" style="margin-bottom: 20px;">
            <input type="text" id="newFeeName" placeholder="Fee Name (e.g. Semester Book Fee)">
            <input type="number" id="newFeeAmount" placeholder="Amount (CAD)">
            <button class="btn btn-primary" onclick="addFeeType()">Add Fee</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Fee Name</th>
                    <th>Default Amount (CAD)</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="feeTableBody"></tbody>
        </table>
    </div>
</div>

<div id="refundModal" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 2000;">
    <h3>Process Refund</h3>
    <p>Transaction: <span id="refundRecordDetails"></span></p>
    <p>Original Amount: <span id="refundOriginalAmount"></span> | Refunded So Far: <span id="refundedSoFar"></span></p>
    <div class="form-group">
        <label for="refundAmount">Amount to Refund (CAD):</label>
        <input type="number" id="refundAmount" min="0.01" step="0.01">
    </div>
    <button class="btn btn-success" onclick="confirmRefund()">Confirm Refund</button>
    <button class="btn btn-secondary" onclick="closeRefundModal()">Cancel</button>
</div>


<div id="notification">Operation Successful!</div>

<script>
    const DB_KEYS = {
        STUDENTS: 'school_students_v3',
        FEES: 'school_fees_v3',
        RECORDS: 'school_records_v3'
    };
    const CURRENCY_CODE = 'CAD';

    let students = JSON.parse(localStorage.getItem(DB_KEYS.STUDENTS)) || [];
    let feeTypes = JSON.parse(localStorage.getItem(DB_KEYS.FEES)) || [];
    let records = JSON.parse(localStorage.getItem(DB_KEYS.RECORDS)) || [];
    let currentCart = [];
    let recordToRefund = null; // For refund functionality

    window.onload = function() {
        renderAll();
        document.getElementById('manualTotal').addEventListener('input', updateFinalAmount);
    };

    function saveData() {
        localStorage.setItem(DB_KEYS.STUDENTS, JSON.stringify(students));
        localStorage.setItem(DB_KEYS.FEES, JSON.stringify(feeTypes));
        localStorage.setItem(DB_KEYS.RECORDS, JSON.stringify(records));
        renderAll();
    }

    function renderAll() {
        renderStudents();
        renderFees();
        renderRecords();
        renderPaymentOptions();
        updateDashboard();
        updateFinalAmount();
    }

    function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        
        document.getElementById(sectionId).classList.add('active');
        
        const buttons = document.querySelectorAll('.nav-btn');
        const sections = ['payment', 'records', 'students', 'fees'];
        const index = sections.indexOf(sectionId);
        if(index !== -1) buttons[index].classList.add('active');
    }

    function showNotification(msg) {
        const notif = document.getElementById('notification');
        notif.textContent = msg;
        notif.style.display = 'block';
        setTimeout(() => { notif.style.display = 'none'; }, 3000);
    }

    /* --- Student Management --- */
    function addStudent() {
        const lNameInput = document.getElementById('newStudentLName');
        const fNameInput = document.getElementById('newStudentFName');
        const divInput = document.getElementById('newStudentDivision');
        
        const lastName = lNameInput.value.trim();
        const firstName = fNameInput.value.trim();
        const division = divInput.value.trim();
        
        if (!lastName || !firstName || !division) return alert('Please enter Last Name, First Name, and Division.');

        const id = 'S' + (students.length + 1).toString().padStart(3, '0');
        students.push({ id, lastName, firstName, division });
        
        lNameInput.value = '';
        fNameInput.value = '';
        divInput.value = '';
        saveData();
        showNotification(`Student Added: ${firstName} ${lastName}`);
    }

    function deleteStudent(index) {
        if(confirm('Are you sure you want to delete this student?')) {
            students.splice(index, 1);
            saveData();
        }
    }

    function renderStudents() {
        const tbody = document.getElementById('studentTableBody');
        const searchInput = document.getElementById('studentSearchInput').value.toLowerCase();
        const searchField = document.getElementById('studentSearchField').value;
        
        let filteredStudents = students.filter(s => {
            if (!searchInput) return true;
            
            const searchTerms = [s.lastName, s.firstName, s.division].map(t => t.toLowerCase());
            
            if (searchField === 'all') {
                return searchTerms.some(term => term.includes(searchInput));
            } else if (searchField === 'lastName') {
                return s.lastName.toLowerCase().includes(searchInput);
            } else if (searchField === 'firstName') {
                return s.firstName.toLowerCase().includes(searchInput);
            } else if (searchField === 'division') {
                return s.division.toLowerCase().includes(searchInput);
            }
            return false;
        });

        if (filteredStudents.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color:#888;">No students found.</td></tr>';
            return;
        }

        tbody.innerHTML = filteredStudents.map(s => {
             const studentIndex = students.findIndex(std => std.id === s.id);
             return `
                 <tr>
                     <td>${s.id}</td>
                     <td>${s.lastName}</td>
                     <td>${s.firstName}</td>
                     <td>${s.division}</td>
                     <td><button class="btn btn-danger" onclick="deleteStudent(${studentIndex})">Delete</button></td>
                 </tr>
             `;
        }).join('');
    }
    
    /* --- Fee Management (Standard Fees) --- */
    function addFeeType() {
        const nameInput = document.getElementById('newFeeName');
        const amountInput = document.getElementById('newFeeAmount');
        const name = nameInput.value.trim();
        const amount = Number(amountInput.value);

        if (!name || amount <= 0 || isNaN(amount)) return alert('Please enter a valid Fee Name and Amount.');

        feeTypes.push({ id: Date.now(), name, amount });
        nameInput.value = '';
        amountInput.value = '';
        saveData();
        showNotification(`Fee Added: ${name}`);
    }

    function deleteFee(index) {
        if(confirm('Are you sure you want to delete this fee item?')) {
            feeTypes.splice(index, 1);
            saveData();
        }
    }

    function renderFees() {
        const tbody = document.getElementById('feeTableBody');
        tbody.innerHTML = feeTypes.map((f, index) => `
            <tr>
                <td>${f.name}</td>
                <td>${CURRENCY_CODE} ${f.amount.toFixed(2)}</td>
                <td><button class="btn btn-danger" onclick="deleteFee(${index})">Delete</button></td>
            </tr>
        `).join('');
    }

    /* --- Payment Counter --- */
    function renderPaymentOptions() {
        const sSelect = document.getElementById('payStudentSelect');
        sSelect.innerHTML = '<option value="">-- Select Student --</option>' + 
            students.map(s => `<option value="${s.id}|${s.firstName} ${s.lastName}">${s.id} - ${s.lastName}, ${s.firstName} (${s.division})</option>`).join('');
    }
    
    function addItemToCart() {
        const itemNameInput = document.getElementById('itemName');
        const itemPriceInput = document.getElementById('itemPrice');
        
        const name = itemNameInput.value.trim();
        const price = Number(itemPriceInput.value);
        
        if (!name || price <= 0 || isNaN(price)) return alert('Please enter a valid Item Name and Price.');
        
        currentCart.push({ name, price: price.toFixed(2) });
        
        itemNameInput.value = '';
        itemPriceInput.value = '';
        
        updateCartDisplay();
    }
    
    function updateCartDisplay() {
        const list = document.getElementById('itemizedList');
        const calculatedTotalDisplay = document.getElementById('calculatedTotalDisplay');
        
        const total = currentCart.reduce((sum, item) => sum + Number(item.price), 0);
        
        calculatedTotalDisplay.value = total.toFixed(2);
        document.getElementById('manualTotal').value = ''; // Clear manual if calculator is used
        updateFinalAmount();

        list.innerHTML = currentCart.map((item, index) => `
            <li>
                <span>${item.name}</span>
                <span>${CURRENCY_CODE} ${item.price} <button class="btn btn-danger" onclick="removeItemFromCart(${index})">X</button></span>
            </li>
        `).join('');
    }
    
    function removeItemFromCart(index) {
        currentCart.splice(index, 1);
        updateCartDisplay();
    }
    
    function resetCart() {
        currentCart = [];
        updateCartDisplay();
    }

    function updateFinalAmount() {
        const calculatedTotal = Number(document.getElementById('calculatedTotalDisplay').value);
        const manualTotal = Number(document.getElementById('manualTotal').value);
        const finalPayAmount = document.getElementById('finalPayAmount');

        if (manualTotal > 0) {
            finalPayAmount.value = manualTotal.toFixed(2);
        } else {
            finalPayAmount.value = calculatedTotal.toFixed(2);
        }
    }

    function processPayment() {
        const sSelect = document.getElementById('payStudentSelect');
        const finalAmountInput = document.getElementById('finalPayAmount');

        if (!sSelect.value) {
            return alert('Please select a student.');
        }

        const studentData = sSelect.value.split('|');
        const studentId = studentData[0];
        const studentName = studentData[1];
        const actualAmount = Number(finalAmountInput.value);
        
        if (actualAmount <= 0 || isNaN(actualAmount)) {
            return alert('Please enter a valid amount.');
        }
        
        let feeName;
        if (currentCart.length > 0) {
            feeName = `Sale (${currentCart.length} items)`;
        } else {
            feeName = 'Manual Entry Fee';
        }

        const record = {
            id: Date.now(),
            date: new Date().toLocaleString(),
            studentId,
            studentName,
            feeName: feeName,
            originalAmount: actualAmount,
            refundedAmount: 0,
            netAmount: actualAmount,
            details: currentCart.length > 0 ? currentCart.map(i => `${i.name}: ${i.price}`).join('; ') : 'Manual Sale'
        };

        records.unshift(record);
        saveData();
        showNotification('Payment Successful!');
        sSelect.value = "";
        resetCart(); // Reset the cart after successful payment
        document.getElementById('manualTotal').value = '';
    }

    /* --- Records & Refunds --- */
    function renderRecords() {
        const tbody = document.getElementById('recordsTableBody');

        if (records.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; color:#888;">No transaction records yet.</td></tr>';
            return;
        }

        tbody.innerHTML = records.map((r, index) => {
            const isFullyRefunded = r.netAmount <= 0;
            const refundBtn = isFullyRefunded 
                ? `<button class="btn btn-secondary" disabled>Fully Refunded</button>`
                : `<button class="btn btn-info" onclick="openRefundModal(${r.id})">Refund</button>`;

            return `
                <tr>
                    <td>${r.date}</td>
                    <td>${r.studentName}</td>
                    <td title="${r.details}">${r.feeName}</td>
                    <td>${CURRENCY_CODE} ${r.originalAmount.toFixed(2)}</td>
                    <td style="color: ${r.refundedAmount > 0 ? 'red' : '#888'};">${CURRENCY_CODE} ${r.refundedAmount.toFixed(2)}</td>
                    <td style="color: ${isFullyRefunded ? '#888' : 'var(--success-color)'}; font-weight:bold;">${CURRENCY_CODE} ${r.netAmount.toFixed(2)}</td>
                    <td>
                        ${refundBtn}
                    </td>
                </tr>
            `;
        }).join('');
    }
    
    function openRefundModal(recordId) {
        recordToRefund = records.find(r => r.id === recordId);
        if (!recordToRefund || recordToRefund.netAmount <= 0) {
            return alert("This transaction is not eligible for refund or is fully refunded.");
        }
        
        document.getElementById('refundRecordDetails').textContent = `${recordToRefund.studentName} - ${recordToRefund.feeName}`;
        document.getElementById('refundOriginalAmount').textContent = `${CURRENCY_CODE} ${recordToRefund.originalAmount.toFixed(2)}`;
        document.getElementById('refundedSoFar').textContent = `${CURRENCY_CODE} ${recordToRefund.refundedAmount.toFixed(2)}`;
        
        const maxRefund = recordToRefund.netAmount;
        document.getElementById('refundAmount').value = maxRefund.toFixed(2);
        document.getElementById('refundAmount').setAttribute('max', maxRefund.toFixed(2));
        
        document.getElementById('refundModal').style.display = 'block';
    }
    
    function closeRefundModal() {
        document.getElementById('refundModal').style.display = 'none';
        recordToRefund = null;
    }

    function confirmRefund() {
        const refundAmountInput = document.getElementById('refundAmount');
        let amount = Number(refundAmountInput.value);
        
        if (amount <= 0 || isNaN(amount)) {
            return alert('Please enter a valid refund amount.');
        }
        
        if (amount > recordToRefund.netAmount) {
            return alert(`Refund amount cannot exceed net payable amount (${CURRENCY_CODE} ${recordToRefund.netAmount.toFixed(2)}).`);
        }
        
        // Process the refund
        recordToRefund.refundedAmount += amount;
        recordToRefund.netAmount -= amount;
        
        // Ensure netAmount is not negative due to floating point arithmetic
        recordToRefund.netAmount = Math.max(0, recordToRefund.netAmount); 
        
        saveData();
        closeRefundModal();
        showNotification(`Refund of ${CURRENCY_CODE} ${amount.toFixed(2)} processed for ${recordToRefund.studentName}.`);
    }

    function updateDashboard() {
        const netTotal = records.reduce((sum, r) => sum + r.netAmount, 0);
        document.getElementById('totalIncome').textContent = `${CURRENCY_CODE} ${netTotal.toFixed(2)}`;
        document.getElementById('totalTransactions').textContent = records.length;
    }

    /* --- Utility Functions --- */
    function clearAllData() {
        if(confirm('This will delete ALL student, fee, and transaction data! Are you sure?')) {
            if(confirm('FINAL CONFIRMATION: Data will be permanently lost!')) {
                localStorage.clear();
                students = [];
                feeTypes = [];
                records = [];
                renderAll();
                showNotification('System reset successful.');
            }
        }
    }

    function exportToExcel() {
        if (records.length === 0) {
            return alert("No data to export!");
        }

        let csvContent = "\uFEFF"; 
        csvContent += "Date/Time,Student ID,Student Name,Fee/Item,Original Amount (CAD),Refunded Amount (CAD),Net Amount (CAD),Details\n";

        records.forEach(row => {
            csvContent += `"${row.date}","${row.studentId}","${row.studentName}","${row.feeName}",${row.originalAmount.toFixed(2)},${row.refundedAmount.toFixed(2)},${row.netAmount.toFixed(2)},"${row.details.replace(/"/g, '""')}"\n`;
        });

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");

        const date = new Date();
        const filename = `Financial_Report_${date.getFullYear()}${String(date.getMonth()+1).padStart(2,'0')}${date.getDate()}.csv`;

        link.href = url;
        link.download = filename;
        link.style.visibility = "hidden";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        showNotification("Report Downloaded!");
    }
</script>

</body>
</html>